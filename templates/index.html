<!DOCTYPE html>
<html>
<head>
  <title>Break Tracker</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    h1 { margin-bottom: 20px; }
    select, button { padding: 8px 12px; margin: 5px; font-size: 16px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    #timer { font-weight: bold; font-size: 18px; margin-left: 10px; }
  </style>
</head>
<body>
  <h1>Break Tracker</h1>

  <!-- Agent Selection & Actions -->
  <form id="breakForm" method="POST">
    <label for="agent">Select Agent:</label>
    <select name="agent" id="agent" required>
      <option value="" disabled selected>Select your name</option>
      {% for agent in agents %}
        <option value="{{ agent }}" {% if selected_agent == agent %}selected{% endif %}>{{ agent }}</option>
      {% endfor %}
    </select>

    <button type="submit" name="action" value="start" id="startBtn">Start Break</button>
    <button type="submit" name="action" value="end" id="endBtn">End Break</button>

    <span id="timer">00:00:00</span>
  </form>

  <!-- Break Logs Table -->
  {% if logs %}
    <h2>Today's Breaks - {{ selected_agent }}</h2>
    <table>
      <tr>
        <th>Start Time</th>
        <th>End Time</th>
        <th>Duration (mins)</th>
      </tr>
      {% for row in logs %}
      <tr>
        <td>{{ row[1] }}</td>
        <td>{{ row[2] or '-' }}</td>
        <td>{{ row[3] or '-' }}</td>
      </tr>
      {% endfor %}
    </table>
  {% endif %}

  <script>
    // Timer functionality
    let timerInterval;
    let startTime = null;

    const startBtn = document.getElementById("startBtn");
    const endBtn = document.getElementById("endBtn");
    const timerDisplay = document.getElementById("timer");
    const agentSelect = document.getElementById("agent");

    function formatTime(seconds) {
      const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
      const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
      const secs = String(seconds % 60).padStart(2, '0');
      return `${hrs}:${mins}:${secs}`;
    }

    function startTimer() {
      if (!agentSelect.value) {
        alert("Please select your name first!");
        return false;
      }
      startTime = new Date();
      timerInterval = setInterval(() => {
        const elapsed = Math.floor((new Date() - startTime) / 1000);
        timerDisplay.textContent = formatTime(elapsed);
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
      timerDisplay.textContent = "00:00:00";
    }

    startBtn.addEventListener("click", function(e) {
      if (!agentSelect.value) {
        e.preventDefault();
        alert("Select your name first before starting break.");
        return false;
      }
      startTimer();
    });

    endBtn.addEventListener("click", function(e) {
      if (!agentSelect.value) {
        e.preventDefault();
        alert("Select your name first before ending break.");
        return false;
      }
      stopTimer();
    });
  </script>
</body>
</html>
